.before_template: &before
# Setup SSH deploy keys
- 'which ssh-agent || ( apt-get install -qq openssh-client )'
- eval $(ssh-agent -s)
- ssh-add <(echo "$SSH_PRIVATE_KEY_DEV")
- mkdir -p ~/.ssh && chmod 700 ~/.ssh 
- echo $SSH_KNOWN_HOSTS >> ~/.ssh/known_hosts && chmod 644 ~/.ssh/known_hosts
- '[[ -f /.dockerenv ]] && echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config'

.deploy_runner:
  stage: deploy
  tags:
    - DEPLOYMENT
  before_script:
    - *before
  variables:
    REGISTRATION_TOKEN: ${GLOBAL_REGISTRATION_TOKEN}
  script:
    - docker-compose up -d
  when: manual

.deploy_runner_oediv:
  extends: .deploy_runner
  variables:
    http_proxy: "http://proxy.de.root.net:3128"
    https_proxy: "http://proxy.de.root.net:3128"
    no_proxy: "localhost,127.0.0.1,127.0.1.1,.localdomain,ntpserver,.ista.net,swarmmanager.service.consul,.consul,jabreg,ap-isa-147-0,jabreg,10.49.139.1,10.49.139.2,10.49.139.3,10.49.139.4,10.49.139.5,10.49.139.6,10.49.139.7,10.49.139.8,10.49.139.9,10.49.139.10,10.49.139.11,10.49.139.12,10.49.139.13,10.49.139.14,10.49.139.15,10.49.139.16,10.49.139.17,10.49.139.18,10.49.139.19,10.49.139.20,10.49.139.21,10.49.139.22,10.49.139.23,10.49.139.24,10.49.139.25,10.49.139.26,10.49.139.27,10.49.139.28,10.49.139.29,10.49.139.30,10.49.139.31,10.49.139.32,10.49.139.33,10.49.139.34,10.49.139.35,10.49.139.36,10.49.139.37,10.49.139.38,10.49.139.39,10.49.139.40,10.49.139.41,10.49.139.42,10.49.139.43,10.49.139.44,10.49.139.45,10.49.139.46,10.49.139.47,10.49.139.48,10.49.139.49,10.49.139.50,10.49.139.51,10.49.139.52,10.49.139.53,10.49.139.54,10.49.139.55,10.49.139.56,10.49.139.57,10.49.139.58,10.49.139.59,10.49.139.60,10.49.139.61,10.49.139.62,10.49.139.63,10.49.139.64,10.49.139.65,10.49.139.66,10.49.139.67,10.49.139.68,10.49."
    HTTP_PROXY: "http://proxy.de.root.net:3128"
    HTTPS_PROXY: "http://proxy.de.root.net:3128"
    NO_PROXY: "localhost,127.0.0.1,127.0.1.1,.localdomain,ntpserver,.ista.net,swarmmanager.service.consul,.consul,jabreg,ap-isa-147-0,jabreg,10.49.139.1,10.49.139.2,10.49.139.3,10.49.139.4,10.49.139.5,10.49.139.6,10.49.139.7,10.49.139.8,10.49.139.9,10.49.139.10,10.49.139.11,10.49.139.12,10.49.139.13,10.49.139.14,10.49.139.15,10.49.139.16,10.49.139.17,10.49.139.18,10.49.139.19,10.49.139.20,10.49.139.21,10.49.139.22,10.49.139.23,10.49.139.24,10.49.139.25,10.49.139.26,10.49.139.27,10.49.139.28,10.49.139.29,10.49.139.30,10.49.139.31,10.49.139.32,10.49.139.33,10.49.139.34,10.49.139.35,10.49.139.36,10.49.139.37,10.49.139.38,10.49.139.39,10.49.139.40,10.49.139.41,10.49.139.42,10.49.139.43,10.49.139.44,10.49.139.45,10.49.139.46,10.49.139.47,10.49.139.48,10.49.139.49,10.49.139.50,10.49.139.51,10.49.139.52,10.49.139.53,10.49.139.54,10.49.139.55,10.49.139.56,10.49.139.57,10.49.139.58,10.49.139.59,10.49.139.60,10.49.139.61,10.49.139.62,10.49.139.63,10.49.139.64,10.49.139.65,10.49.139.66,10.49.139.67,10.49.139.68,10.49."

Runner OEDIV test on ap-isa-120-0:
  extends: .deploy_runner_oediv
  environment:
    name: OEDIV/ap-isa-120-0
  variables:
    DOCKER_HOST: "ssh://${DEPLOYMENT_USER_GITLAB}@10.49.139.220"
    RUNNER_NAME: "ISDP-ap-isa-120--10.49.139.220"
    TAG_LIST: "ISDP_TEST_OEDIV"
    TOKEN: ${GLOBAL_GITLAB_TOKEN}
